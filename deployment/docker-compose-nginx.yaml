services:
  infoservice:
    image: cptml/incsys-info:latest
    ports:
      - "8000:8000"
    environment:
      - SPRING_PROFILES_ACTIVE=production
      - SERVER_SERVLET_CONTEXT_PATH=${INFO_CONTEXT:-/info}
      - PROVIDER_SHARED_SECRET=${PROVIDER_SHARED_SECRET}
      - STORE_SHARED_SECRET=${STORE_SHARED_SECRET}
      - SPRINGFOX_HOST=${HOST:-incentives.cs.uni-paderborn.de}
    networks:
      - provider
    hostname: infoservice
  incentiveservice:
    image: cptml/incsys-provider:latest
    ports:
      - "8012:8012"
    environment:
      - SPRING_PROFILES_ACTIVE=production
      - SERVER_SERVLET_CONTEXT_PATH=${INCENTIVE_CONTEXT:-/incentive}
      - PROVIDER_SHARED_SECRET=${PROVIDER_SHARED_SECRET}
      - INCENTIVE_SERVICE_PROVIDER_SECRET=${INCENTIVE_PROVIDER_SECRET}
      - INFO_SERVICE_URL=http://infoservice:8000${INFO_CONTEXT:-/info}
      - SPRINGFOX_HOST=${HOST:-incentives.cs.uni-paderborn.de}
    networks:
      - provider
    hostname: incentiveservice
  basketservice:
    image: cptml/incsys-store:latest
    ports:
      - "8010:8010"
    environment:
      - SPRING_PROFILES_ACTIVE=production
      - SERVER_SERVLET_CONTEXT_PATH=${BASKET_CONTEXT:-/basket}
      - STORE_NAME=First Store
      - BASKET_SERVICE_PROVIDER_SECRET=${BASKET_PROVIDER_SECRET}
      - STORE_SHARED_SECRET=${STORE_SHARED_SECRET}
      - INFO_SERVICE_URL=http://infoservice:8000${INFO_CONTEXT:-/info}
      - INCENTIVE_SERVICE_URL=http://incentiveservice:8012${INCENTIVE_CONTEXT:-/incentive}
      - SPRINGFOX_HOST=${HOST:-incentives.cs.uni-paderborn.de}
    networks:
      - provider
    hostname: basketservice
  basketservice-two:
    image: cptml/incsys-store:latest
    ports:
      - "8011:8010"
    environment:
      - SPRING_PROFILES_ACTIVE=production
      - SERVER_SERVLET_CONTEXT_PATH=${BASKET_CONTEXT:-/basket-two}
      - STORE_NAME=Second Store
      - BASKET_SERVICE_PROVIDER_SECRET=${BASKET_PROVIDER_SECRET_TWO}
      - STORE_SHARED_SECRET=${STORE_SHARED_SECRET}
      - INFO_SERVICE_URL=http://infoservice:8000${INFO_CONTEXT:-/info}
      - INCENTIVE_SERVICE_URL=http://incentiveservice:8012${INCENTIVE_CONTEXT:-/incentive}
      - SPRINGFOX_HOST=${HOST:-incentives.cs.uni-paderborn.de}
    networks:
      - provider
    hostname: basketservicetwo
  bootstrapservice:
    image: cptml/incsys-bootstrap:latest
    environment:
      - SPRING_PROFILES_ACTIVE=production
      - BASKET_SERVICE_URLS=http://basketservice:8010${BASKET_CONTEXT:-/basket},http://basketservicetwo:8010${BASKET_CONTEXT_TWO:-/basket-two}
      - BASKET_SERVICE_PROVIDER_SECRETS=${BASKET_PROVIDER_SECRET},${BASKET_PROVIDER_SECRET_TWO}
      - INCENTIVE_SERVICE_URL=http://incentiveservice:8012${INCENTIVE_CONTEXT:-/incentive}
      - INCENTIVE_SERVICE_PROVIDER_SECRET=${INCENTIVE_PROVIDER_SECRET}
    depends_on:
      - basketservice
      - incentiveservice
    networks:
      - provider
  web:
    image: cmpt/incentive-system-web:latest
    ports:
      - "8080:80"
networks:
  provider:
    driver: bridge
    ipam:
      driver: default

